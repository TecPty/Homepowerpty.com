<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Navide&#241;o - Home Power Panam&#225;</title>
    <style>
        :root {
            --bg-center: #f6d36a;
            --bg-edge: #b6781f;
            --text-main: #111111;
            --gift-red: #ef4444;
            --gift-dark: #b91c1c;
            --ribbon: #facc15;
            --ribbon-dark: #d97706;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: "Segoe UI", "Georgia", serif;
            background: #5a3b00;
            color: var(--text-main);
        }

        button {
            border: none;
            background: none;
        }

        button:focus-visible {
            outline: 2px solid rgba(255, 255, 255, 0.7);
            outline-offset: 2px;
        }

        /* ===== ANIMACIONES KEYFRAMES ===== */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        @keyframes glowPulse { 0%, 100% { opacity: 0.6; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        @keyframes snowfall { 0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(110vh) rotate(360deg); opacity: 0; } }
        @keyframes giftFloat { 0%, 100% { transform: translateY(0) rotate(-1.5deg); } 50% { transform: translateY(-10px) rotate(1.5deg); } }
        @keyframes lidOpen { 0% { transform: translateY(0) rotate(0deg); } 40% { transform: translateY(-26px) rotate(-6deg); } 60% { transform: translateY(-20px) rotate(-4deg); } 100% { transform: translateY(-24px) rotate(-5deg); } }
        @keyframes lidFall { 0% { transform: translate(-10px, -24px) rotate(-5deg); opacity: 1; } 50% { transform: translate(-40px, 40px) rotate(-32deg); opacity: 1; } 100% { transform: translate(-110px, 160px) rotate(-82deg); opacity: 0; } }
        @keyframes burst { 0% { opacity: 0; transform: scale(0.6); } 20% { opacity: 0.9; transform: scale(1); } 80% { opacity: 0.4; transform: scale(1.5); } 100% { opacity: 0; transform: scale(1.8); } }
        @keyframes shooting {
            0% { transform: translate3d(0, 0, 0) rotate(-12deg); opacity: 0; }
            15% { opacity: 1; }
            50% { transform: translate3d(-140px, 40px, 0) rotate(-18deg); }
            100% { transform: translate3d(-260px, 120px, 0) rotate(-22deg); opacity: 0; }
        }
        @keyframes fireworkBurst {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            30% { opacity: 1; }
            100% { transform: translate(calc(-50% + var(--dx, 0px)), calc(-50% + var(--dy, 0px))) scale(1); opacity: 0; }
        }
        @keyframes fireworkArc {
            0% { transform: translate(-50%, -50%) scale(0.2); opacity: 0; }
            25% { opacity: 1; }
            100% { transform: translate(calc(-50% + var(--dx, 0px)), calc(-50% + var(--dy, 0px))) scale(1); opacity: 0; }
        }
        @keyframes rocketRise {
            0% { transform: translate(-50%, 40px) scale(0.4); opacity: 0; }
            25% { opacity: 1; }
            70% { transform: translate(-50%, -140px) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -170px) scale(0.9); opacity: 0; }
        }
        @keyframes productPop {
            0% { transform: translate(-50%, var(--start-y, 80px)) scale(0.4) rotate(-8deg); opacity: 0; }
            40% { transform: translate(-50%, -40px) scale(1.05) rotate(6deg); opacity: 1; }
            70% { transform: translate(calc(-50% + var(--offset-x, 0px)), calc(var(--target-y, 200px) - 12px)) scale(0.98) rotate(-3deg); opacity: 1; }
            100% { transform: translate(calc(-50% + var(--offset-x, 0px)), var(--target-y, 200px)) scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes logoRise {
            0% { transform: translate(-50%, 20px) scale(0.7); opacity: 0; }
            60% { transform: translate(-50%, -40px) scale(1.05); opacity: 1; }
            100% { transform: translate(-50%, -28px) scale(1); opacity: 1; }
        }

        /* ===== MODAL OVERLAY ===== */
        .christmas-modal-overlay {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            animation: fadeIn 1s ease-in-out;
            pointer-events: auto;
        }

        .hidden { display: none !important; visibility: hidden; }

        /* ===== FONDO ===== */
        .christmas-background {
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at center, var(--bg-center) 0%, var(--bg-edge) 100%);
            overflow: hidden;
            z-index: 1;
        }
        .christmas-background::after {
            content: "";
            position: absolute;
            inset: -30%;
            background: radial-gradient(circle at 50% 30%, rgba(255,255,255,0.15), transparent 55%);
            filter: blur(60px);
            opacity: 0.6;
            pointer-events: none;
        }

        .background-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: white;
            border-radius: 50%;
            z-index: 2;
            animation: twinkle 2.5s ease-in-out infinite;
        }
        .background-star.star-large { width: 2.5px; height: 2.5px; }
        .background-star.star-medium { width: 1.5px; height: 1.5px; }

        /* ===== CONTENIDO PRINCIPAL ===== */
        .christmas-modal-content {
            position: relative;
            z-index: 10;
            width: min(1200px, 92vw);
            padding: clamp(24px, 4vw, 48px);
        }

        /* ===== BOT&Oacute;N CERRAR ===== */
        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            border: 1.5px solid rgba(255, 255, 255, 0.35);
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
            z-index: 15;
        }
        .close-button:hover {
            background: rgba(255, 255, 255, 0.16);
            transform: rotate(90deg) scale(1.05);
            border-color: rgba(255, 255, 255, 0.55);
        }

        /* ===== LAYOUT ===== */
        .modal-layout-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            justify-items: center;
            gap: clamp(20px, 4vw, 48px);
            width: 100%;
        }

        .text-column {
            text-align: center;
            color: #111;
            max-width: 320px;
        }
        .text-column.desktop-only { display: none; }
        .text-column.mobile-only { display: none; width: 100%; }

        .text-column h2 {
            font-family: "Georgia", serif;
            font-size: clamp(22px, 2.5vw, 36px);
            font-weight: 700;
            line-height: 1.35;
            margin-bottom: 12px;
            text-shadow: 0 2px 12px rgba(0, 0, 0, 0.45);
        }
        .text-column .subtitle {
            font-family: "Georgia", serif;
            font-size: clamp(13px, 1.6vw, 17px);
            color: rgba(0, 0, 0, 0.78);
            margin-bottom: 20px;
            font-style: italic;
            text-shadow: 0 1px 6px rgba(0, 0, 0, 0.4);
        }
        .text-column .main-message {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            font-size: clamp(14px, 1.25vw, 17px);
            color: rgba(0, 0, 0, 0.9);
            line-height: 1.7;
            text-shadow: 0 1px 6px rgba(0, 0, 0, 0.4);
        }

        /* ===== REGALO ===== */
        .gift-container {
            position: relative;
            width: clamp(240px, 28vw, 360px);
            height: clamp(340px, 34vw, 420px);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 5;
        }
        .gift-lid {
            transform-box: fill-box;
            transform-origin: 50% 60%;
        }
        .gift-container.open .gift-lid {
            animation: lidOpen 0.9s ease-out forwards, lidFall 1.2s ease-in forwards 0.9s;
            transform-origin: 50% 60%;
            transform-box: fill-box;
        }
        .gift-container.open .gift-burst {
            animation: burst 1.4s ease-out forwards;
        }
        .gift-glow {
            position: absolute;
            width: 90%;
            height: 90%;
            background: radial-gradient(circle, rgba(255,255,255,0.18), transparent 60%);
            filter: blur(16px);
            z-index: 6;
            pointer-events: none;
        }
        .gift-burst {
            position: absolute;
            width: 120%;
            height: 120%;
            background: radial-gradient(circle, rgba(250,204,21,0.35) 0%, rgba(255,255,255,0.15) 40%, rgba(255,255,255,0) 70%);
            opacity: 0;
            transform: scale(0.6);
            mix-blend-mode: screen;
            pointer-events: none;
            z-index: 6;
        }
        .gift-svg {
            position: relative;
            width: clamp(220px, 24vw, 320px);
            height: clamp(220px, 24vw, 320px);
            z-index: 8;
            animation: giftFloat 4.5s ease-in-out infinite;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.35));
        }
        .sparkles-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 7;
        }
        .sparkle {
            position: absolute;
            border-radius: 50%;
            filter: drop-shadow(0 0 6px currentColor) drop-shadow(0 0 12px rgba(255, 255, 255, 0.3));
            animation: glowPulse var(--duration, 2s) ease-in-out infinite;
        }
        .gift-items {
            position: absolute;
            inset: 0;
            z-index: 9;
            pointer-events: none;
        }
        .product-item {
            position: absolute;
            left: 50%;
            top: 0px;
            width: 140px;
            height: 140px;
            padding: 0;
            border-radius: 12px;
            background: transparent;
            box-shadow: none;
            opacity: 0;
            transform: translate(-50%, var(--start-y, 80px)) scale(0.4);
            animation: productPop 1.2s cubic-bezier(0.3, 1.05, 0.35, 1) forwards;
            animation-delay: var(--delay, 0s);
            transform-origin: center;
            letter-spacing: 0.2px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .product-img {
            width: 100%;
            height: 100%;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: none;
        }
        .surprise-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            opacity: 0;
            animation: burst 1s ease-out forwards;
            pointer-events: none;
        }
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            opacity: 0;
            animation: fireworkBurst 1s ease-out forwards;
            filter: drop-shadow(0 0 6px rgba(255,255,255,0.7));
            pointer-events: none;
        }
        .firework-arc {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            opacity: 0;
            animation: fireworkArc 1.2s ease-out forwards;
            filter: drop-shadow(0 0 6px rgba(255,255,255,0.7));
            pointer-events: none;
        }
        .firework-rocket {
            position: absolute;
            width: 6px;
            height: 16px;
            border-radius: 50% 50% 40% 40%;
            background: linear-gradient(180deg, #fff, #facc15);
            opacity: 0;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.8));
            animation: rocketRise 0.7s ease-out forwards;
            pointer-events: none;
        }
        .gift-logo-front {
            position: absolute;
            left: 50%;
            bottom: 40px;
            width: 960px;
            height: 288px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            mix-blend-mode: normal;
            filter: drop-shadow(0 6px 14px rgba(0,0,0,0.35));
            opacity: 0;
            transform: translate(-50%, 80px) scale(0.4);
            z-index: 10;
            animation: productPop 1.2s cubic-bezier(0.3, 1.05, 0.35, 1) forwards;
            animation-delay: var(--logo-delay, 1s);
            --target-y: 120px;
            --offset-x: 0px;
        }

        /* ===== COPOS ===== */
        .snowflake {
            position: absolute;
            z-index: 3;
            pointer-events: none;
            opacity: 0;
        }
        .shooting-star {
            position: absolute;
            width: 140px;
            height: 2px;
            background: linear-gradient(90deg, rgba(255,255,255,0.9), rgba(255,255,255,0));
            opacity: 0;
            border-radius: 999px;
            transform: rotate(-18deg);
            filter: drop-shadow(0 0 6px rgba(255,255,255,0.8));
            pointer-events: none;
            z-index: 4;
            animation: shooting var(--duration, 2.4s) ease-out var(--delay, 0s) infinite;
        }

        /* ===== RESPONSIVIDAD ===== */
        @media (min-width: 1024px) { .text-column.desktop-only { display: block; } }
        @media (max-width: 1023px) {
            .modal-layout-container { grid-template-columns: 1fr; gap: 22px; }
            .text-column.mobile-only { display: block; margin-top: 14px; }
            .gift-container { width: clamp(220px, 36vw, 300px); height: 360px; }
            .gift-svg { width: clamp(200px, 32vw, 260px); height: clamp(200px, 32vw, 260px); }
        }
        @media (max-width: 640px) {
            .christmas-modal-content { padding: 20px 16px; }
            .modal-layout-container { gap: 18px; }
            .gift-container { width: 200px; height: 320px; }
            .gift-svg { width: 180px; height: 200px; }
            .text-column.mobile-only h2 { font-size: clamp(18px, 5vw, 24px); }
            .text-column.mobile-only .subtitle { font-size: clamp(12px, 3vw, 15px); }
            .text-column.mobile-only .main-message { font-size: clamp(13px, 2.1vw, 15px); }
            .close-button { width: 38px; height: 38px; font-size: 18px; top: 14px; right: 14px; }
        }

        @media (prefers-reduced-motion: reduce) {
            * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
        }
    </style>
</head>
<body>

<div id="christmasModal" class="christmas-modal-overlay hidden" aria-modal="true" role="dialog">
    <div class="christmas-background" id="christmasBackground"></div>
    <button class="close-button" id="closeButton" aria-label="Cerrar modal navide&ntilde;o">X</button>

    <div class="christmas-modal-content" id="christmasModalContent">
        <div class="modal-layout-container">
            <div class="text-column desktop-only">
                <h2>Feliz Navidad y<br>Pr&oacute;spero A&ntilde;o Nuevo</h2>
                <p class="subtitle">Les desea el equipo de HOME POWER</p>
            </div>

            <div class="gift-container">
                <div class="gift-glow"></div>
                <div class="gift-burst" id="giftBurst"></div>
                <div class="sparkles-container" id="sparklesContainer"></div>
                <div class="gift-items" id="giftItems"></div>
                <div class="gift-logo-front" id="giftLogoFront"></div>
                <div class="gift-svg" id="giftSvg"></div>
            </div>

            <div class="text-column desktop-only">
                <p class="main-message">Gracias por confiar en Home Power Panam&aacute; durante este a&ntilde;o de crecimiento. Que esta Navidad traiga paz y energ&iacute;a renovada, y que el 2026 nos encuentre impulsando nuevos proyectos y alcanzando metas a&uacute;n mayores juntos.</p>
            </div>

            <div class="text-column mobile-only">
                <h2>Feliz Navidad y Pr&oacute;spero A&ntilde;o Nuevo</h2>
                <p class="subtitle">Les desea HOME POWER</p>
                <p class="main-message">Gracias por confiar en Home Power Panam&aacute; durante este a&ntilde;o de crecimiento. Que esta Navidad traiga paz y energ&iacute;a renovada, y que el 2026 nos encuentre impulsando nuevos proyectos y alcanzando metas a&uacute;n mayores juntos.</p>
            </div>
        </div>
    </div>
</div>

<script>
    class ChristmasModal {
        constructor() {
            this.modal = document.getElementById('christmasModal');
            this.modalContent = document.getElementById('christmasModalContent');
            this.closeButton = document.getElementById('closeButton');
            this.background = document.getElementById('christmasBackground');
            this.giftContainer = document.querySelector('.gift-container');
            this.sparklesContainer = document.getElementById('sparklesContainer');
            this.giftItems = document.getElementById('giftItems');
            this.giftLogoFront = document.getElementById('giftLogoFront');
            this.giftSvg = document.getElementById('giftSvg');

            this.colors = ['#67e8f9', '#22d3ee', '#06b6d4', '#0891b2', '#93c5fd', '#ef4444', '#fbbf24', '#22c55e'];
            this.initialized = false;
            this.logoDelay = 1.6;
            this.STORAGE_KEY = 'homepower_christmas_modal_shown_v4';

            this.init();
        }

        init() {
            this.attachEventListeners();
            this.scheduleModalDisplay();
        }

        attachEventListeners() {
            this.closeButton.addEventListener('click', () => this.closeModal());
            this.modal.addEventListener('click', (e) => {
                const clickedOutside = !this.modalContent.contains(e.target);
                if (clickedOutside) this.closeModal();
            });
        }

        scheduleModalDisplay() {
            const show = () => {
                // Primer intento controlado por localStorage
                setTimeout(() => {
                    if (this.shouldShowOnce()) this.showModal();
                }, 500);
                // Fallback por si la clave impide mostrar o hay algún bloqueo
                setTimeout(() => {
                    if (!this.initialized) this.showModal(true);
                }, 1500);
            };
            if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', show);
            else show();
        }

        showModal(force = false) {
            if (this.initialized) return;
            if (!force && !this.shouldShowOnce()) return;
            this.initialized = true;
            this.markShown();
            this.modal.classList.remove('hidden');
            this.resetDynamicLayers();
            this.createStars();
            this.createSnowflakes();
            this.createShootingStars();
            this.createSparkles();
            this.createProducts();
            this.createLogoFront();
            this.createGift();
            this.animateGiftOpen();
        }

        closeModal() {
            this.modal.classList.add('hidden');
            this.initialized = false;
        }

        resetDynamicLayers() {
            this.background.innerHTML = '';
            this.sparklesContainer.innerHTML = '';
            this.giftItems.innerHTML = '';
            this.giftLogoFront.style.backgroundImage = '';
            this.giftLogoFront.textContent = '';
            this.giftSvg.innerHTML = '';
            this.giftContainer.classList.remove('open');
        }

        shouldShowOnce() {
            try {
                return !localStorage.getItem(this.STORAGE_KEY);
            } catch (e) {
                return true;
            }
        }

        markShown() {
            try {
                localStorage.setItem(this.STORAGE_KEY, 'true');
            } catch (e) {
                /* ignore */
            }
        }

        createStars() {
            const starCount = 200;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'background-star';
                const sizeRandom = Math.random();
                if (sizeRandom > 0.8) star.classList.add('star-large');
                else if (sizeRandom > 0.5) star.classList.add('star-medium');
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                const duration = 2 + Math.random();
                star.style.animationDuration = duration.toFixed(2) + 's';
                star.style.animationDelay = (Math.random() * 2).toFixed(2) + 's';
                this.background.appendChild(star);
            }
        }

        createSnowflakes() {
            const snowflakeCount = 100;
            const svgNS = 'http://www.w3.org/2000/svg';
            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                const size = 8 + Math.random() * 10; // estrellas pequeÃ±as
                const svg = document.createElementNS(svgNS, 'svg');
                svg.setAttribute('viewBox', '0 0 100 100');
                svg.setAttribute('width', size);
                svg.setAttribute('height', size);
                svg.setAttribute('style', 'fill:none;stroke:white;stroke-width:4;stroke-linejoin:round;stroke-linecap:round;');

                // Estrella de 5 puntas
                const points = [];
                const outerR = 45;
                const innerR = 20;
                for (let j = 0; j < 5; j++) {
                    const outerAngle = (-90 + j * 72) * Math.PI / 180;
                    const innerAngle = (-90 + j * 72 + 36) * Math.PI / 180;
                    points.push([50 + outerR * Math.cos(outerAngle), 50 + outerR * Math.sin(outerAngle)]);
                    points.push([50 + innerR * Math.cos(innerAngle), 50 + innerR * Math.sin(innerAngle)]);
                }
                const polygon = document.createElementNS(svgNS, 'polygon');
                polygon.setAttribute('points', points.map(p => p.join(',')).join(' '));
                svg.appendChild(polygon);

                snowflake.appendChild(svg);
                snowflake.style.left = Math.random() * 100 + '%';
                const duration = 10 + Math.random() * 10;
                const delay = Math.random() * 5;
                snowflake.style.setProperty('--duration', duration + 's');
                snowflake.style.setProperty('--delay', delay + 's');
                snowflake.style.animation = `snowfall var(--duration) linear var(--delay) infinite`;
                this.background.appendChild(snowflake);
            }
        }

        createShootingStars() {
            const shootingCount = 10;
            for (let i = 0; i < shootingCount; i++) {
                const star = document.createElement('div');
                star.className = 'shooting-star';
                const startX = 60 + Math.random() * 35; // start more to la derecha
                const startY = Math.random() * 30; // banda superior
                star.style.left = startX + 'vw';
                star.style.top = startY + 'vh';
                const duration = 2 + Math.random() * 1.5;
                const delay = Math.random() * 5;
                star.style.setProperty('--duration', duration + 's');
                star.style.setProperty('--delay', delay + 's');
                this.background.appendChild(star);
            }
        }

        createSparkles() {
            const sparkleCount = 70;
            const width = this.sparklesContainer.offsetWidth || 280;
            const height = this.sparklesContainer.offsetHeight || 320;
            for (let i = 0; i < sparkleCount; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                const size = 2.5 + Math.random() * 3.5;
                sparkle.style.width = size + 'px';
                sparkle.style.height = size + 'px';
                const radius = Math.min(width, height) * 0.45 * Math.random();
                const angle = Math.random() * Math.PI * 2;
                const centerX = width / 2;
                const centerY = height / 2;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                sparkle.style.left = x + 'px';
                sparkle.style.top = y + 'px';
                sparkle.style.transform = 'translate(-50%, -50%)';
                const color = this.colors[Math.floor(Math.random() * this.colors.length)];
                sparkle.style.backgroundColor = color;
                sparkle.style.color = color;
                const duration = 1.8 + Math.random() * 0.6;
                sparkle.style.setProperty('--duration', duration + 's');
                sparkle.style.animationDuration = 'var(--duration)';
                sparkle.style.animationDelay = (Math.random() * 2).toFixed(2) + 's';
                this.sparklesContainer.appendChild(sparkle);
            }
        }

        createProducts() {
            const products = [
                { img: '/media/images/products/PLANCHA_VAPOR_2.webp', alt: 'Plancha eléctrica Home Power', offsetX: 140, targetY: 270 },
                { img: '/media/images/products/LICUADORA_ROJA_3.webp', alt: 'Licuadora Home Power', offsetX: 260, targetY: 280 },
                { img: '/media/images/products/TOSTADORA.webp', alt: 'Tostadora Home Power', offsetX: -140, targetY: 270 },
            ];
            const baseDelay = 2.4; // tras la tapa
            const step = 0.5;      // intervalo breve entre objetos
            this.giftItems.innerHTML = '';
            products.forEach((p, idx) => {
                const item = document.createElement('div');
                item.className = 'product-item';
                item.style.setProperty('--target-y', `${p.targetY}px`);
                item.style.setProperty('--offset-x', `${p.offsetX}px`);
                const delayVal = baseDelay + idx * step;
                item.style.setProperty('--delay', `${delayVal}s`);
                const img = document.createElement('div');
                img.className = 'product-img';
                img.style.backgroundImage = `url('${p.img}')`;
                img.setAttribute('aria-label', p.alt);
                item.appendChild(img);
                this.giftItems.appendChild(item);
                this.createSurpriseParticles((this.giftContainer.offsetWidth || 280) / 2, 110, delayVal);
            });
            this.logoDelay = baseDelay + products.length * step;
            this.giftLogoFront.style.setProperty('--logo-delay', `${this.logoDelay}s`);
            setTimeout(() => this.createFireworks(), (this.logoDelay + 0.6) * 1000);
        }

        createLogoFront() {
            this.giftLogoFront.style.backgroundImage = "url('/media/icons/logo/logo.png')";
            this.giftLogoFront.textContent = '';
            this.giftLogoFront.setAttribute('aria-label', 'Home Power');
            this.giftLogoFront.style.setProperty('--logo-delay', `${this.logoDelay}s`);
        }

        createGift() {
            const svg = `
                <svg viewBox="0 0 320 320" xmlns="http://www.w3.org/2000/svg" aria-label="Regalo navideño">
                    <defs>
                        <linearGradient id="boxFront" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#f97316" />
                            <stop offset="60%" stop-color="#ef4444" />
                            <stop offset="100%" stop-color="#b91c1c" />
                        </linearGradient>
                        <linearGradient id="boxSide" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#fbbf24" />
                            <stop offset="60%" stop-color="#ea580c" />
                            <stop offset="100%" stop-color="#9a3412" />
                        </linearGradient>
                        <linearGradient id="boxTop" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#fca85a" />
                            <stop offset="100%" stop-color="#e14b3a" />
                        </linearGradient>
                        <linearGradient id="ribbonGold" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#fef3c7" />
                            <stop offset="50%" stop-color="#fbbf24" />
                            <stop offset="100%" stop-color="#d97706" />
                        </linearGradient>
                        <pattern id="logoPattern" x="0" y="0" width="64" height="64" patternUnits="userSpaceOnUse">
                            <image href="/media/icons/logo/logo.png" x="4" y="4" width="56" height="20" opacity="0.18" />
                        </pattern>
                        <filter id="giftShadow" x="-20%" y="-20%" width="140%" height="140%">
                            <feDropShadow dx="0" dy="12" stdDeviation="10" flood-color="rgba(0,0,0,0.35)" />
                        </filter>
                    </defs>

                    <g filter="url(#giftShadow)">
                        <!-- Frente -->
                        <rect x="70" y="120" width="150" height="150" rx="0" fill="url(#boxFront)" />
                        <rect x="70" y="120" width="150" height="150" rx="0" fill="url(#logoPattern)" />
                        <!-- Lado derecho -->
                        <polygon points="220,120 270,100 270,250 220,270" fill="url(#boxSide)" />
                        <polygon points="220,120 270,100 270,250 220,270" fill="url(#logoPattern)" opacity="0.35" />
                        <!-- Cara superior -->
                        <polygon points="70,120 120,100 270,100 220,120" fill="url(#boxTop)" />
                        <polygon points="70,120 120,100 270,100 220,120" fill="url(#logoPattern)" opacity="0.25" />

                        <!-- Cinta vertical -->
                        <rect x="140" y="120" width="26" height="150" rx="0" fill="url(#ribbonGold)" />
                        <polygon points="220,120 240,112 240,262 220,270" fill="url(#ribbonGold)" opacity="0.9" />
                        <!-- Cinta horizontal -->
                        <rect x="70" y="182" width="150" height="16" rx="0" fill="url(#ribbonGold)" />
                        <polygon points="220,182 270,162 270,178 220,198" fill="url(#ribbonGold)" opacity="0.9" />

                        <!-- Brillos -->
                        <rect x="82" y="138" width="58" height="9" rx="0" fill="rgba(255,255,255,0.28)" />
                        <rect x="160" y="184" width="46" height="9" rx="0" fill="rgba(255,255,255,0.24)" />
                        <ellipse cx="150" cy="210" rx="86" ry="22" fill="rgba(0,0,0,0.08)" />
                    </g>

                    <g class="gift-lid">
                        <polygon points="70,120 120,100 270,100 220,120" fill="url(#boxTop)" stroke="rgba(0,0,0,0.22)" stroke-width="2" />
                        <polygon points="140,100 168,100 238,100 238,114 140,114" fill="url(#ribbonGold)" opacity="0.9" />
                        <!-- Moño -->
                        <path d="M155 88 C145 80 132 78 124 88 C116 98 124 106 136 104 C146 102 154 96 155 88 Z" fill="#facc15" stroke="#d97706" stroke-width="2" />
                        <path d="M165 88 C175 80 188 78 196 88 C204 98 196 106 184 104 C174 102 166 96 165 88 Z" fill="#facc15" stroke="#d97706" stroke-width="2" />
                        <ellipse cx="160" cy="95" rx="16" ry="8" fill="#f9a825" stroke="#b45309" stroke-width="2" />
                        <path d="M140 95 C148 86 172 86 180 95" stroke="#fef9c3" stroke-width="6" stroke-linecap="round" />
                    </g>
                </svg>
            `;
            this.giftSvg.innerHTML = svg;
        }

        animateGiftOpen() {
            this.giftContainer.classList.remove('open');
            requestAnimationFrame(() => {
                setTimeout(() => this.giftContainer.classList.add('open'), 400);
                setTimeout(() => this.createSurpriseParticles(), 400);
            });
        }

        createSurpriseParticles(originX, originY, delay = 0) {
            const colors = ['#fde68a', '#fbbf24', '#fef3c7', '#f472b6', '#60a5fa', '#34d399'];
            const count = 18;
            const centerX = originX ?? (this.giftContainer.offsetWidth || 280) / 2;
            const centerY = originY ?? (this.giftContainer.offsetHeight || 320) / 2;
            setTimeout(() => {
                for (let i = 0; i < count; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'surprise-dot';
                    const size = 4 + Math.random() * 4;
                    dot.style.width = `${size}px`;
                    dot.style.height = `${size}px`;
                    dot.style.backgroundColor = colors[i % colors.length];
                    const angle = Math.random() * Math.PI * 2;
                    const radius = 40 + Math.random() * 120;
                    const tx = Math.cos(angle) * radius;
                    const ty = Math.sin(angle) * radius;
                    dot.style.left = `${centerX}px`;
                    dot.style.top = `${centerY}px`;
                    dot.style.transform = `translate(${tx}px, ${ty}px)`;
                    dot.style.animationDuration = `${0.8 + Math.random() * 0.5}s`;
                    dot.style.animationDelay = `${Math.random() * 0.2}s`;
                    this.giftItems.appendChild(dot);
                    setTimeout(() => dot.remove(), 1600);
                }
            }, delay * 1000);
        }

        createFireworks() {
            const colors = ['#22d3ee', '#ef4444', '#22c55e', '#facc15', '#ffffff', '#f97316'];
            const bursts = 10;
            const baseCenterX = (this.giftContainer.offsetWidth || 280) / 2;
            const baseCenterY = 90;
            const spreadRadius = 90;

            for (let b = 0; b < bursts; b++) {
                const arc = Math.random() * Math.PI * 2;
                const radius = Math.random() * spreadRadius;
                const centerX = baseCenterX + Math.cos(arc) * radius;
                const centerY = baseCenterY + Math.sin(arc) * radius * 0.6;
                const burstDelay = b * 0.18;
                const rocket = document.createElement('div');
                rocket.className = 'firework-rocket';
                rocket.style.left = `${centerX}px`;
                rocket.style.top = `${centerY + 80}px`;
                rocket.style.animationDelay = `${burstDelay}s`;
                this.giftItems.appendChild(rocket);
                setTimeout(() => rocket.remove(), (burstDelay + 0.9) * 1000);

                setTimeout(() => {
                    // esfera principal
                    for (let i = 0; i < 22; i++) {
                        const fw = document.createElement('div');
                        fw.className = 'firework';
                        const size = 4 + Math.random() * 5;
                        fw.style.width = `${size}px`;
                        fw.style.height = `${size}px`;
                        fw.style.backgroundColor = colors[(i + b) % colors.length];
                        const angle = Math.random() * Math.PI * 2;
                        const r = 70 + Math.random() * 120;
                        fw.style.setProperty('--dx', `${Math.cos(angle) * r}px`);
                        fw.style.setProperty('--dy', `${Math.sin(angle) * r}px`);
                        fw.style.left = `${centerX}px`;
                        fw.style.top = `${centerY}px`;
                        fw.style.animationDuration = `${0.9 + Math.random() * 0.35}s`;
                        this.giftItems.appendChild(fw);
                        setTimeout(() => fw.remove(), 1700);
                    }
                    // arcos en abanico para simular caída
                    for (let i = 0; i < 12; i++) {
                        const arcDot = document.createElement('div');
                        arcDot.className = 'firework-arc';
                        arcDot.style.backgroundColor = colors[(i + b * 2) % colors.length];
                        const fanAngle = (-80 + i * 14 + (Math.random() * 8 - 4)) * Math.PI / 180;
                        const r = 110 + Math.random() * 90;
                        const dy = Math.sin(fanAngle) * r + 40; // empuja hacia abajo
                        const dx = Math.cos(fanAngle) * r;
                        arcDot.style.setProperty('--dx', `${dx}px`);
                        arcDot.style.setProperty('--dy', `${dy}px`);
                        arcDot.style.left = `${centerX}px`;
                        arcDot.style.top = `${centerY}px`;
                        arcDot.style.animationDuration = `${1.05 + Math.random() * 0.4}s`;
                        this.giftItems.appendChild(arcDot);
                        setTimeout(() => arcDot.remove(), 1900);
                    }
                    // chispa central brillante
                    const core = document.createElement('div');
                    core.className = 'firework';
                    core.style.width = '10px';
                    core.style.height = '10px';
                    core.style.backgroundColor = '#fff';
                    core.style.left = `${centerX}px`;
                    core.style.top = `${centerY}px`;
                    core.style.setProperty('--dx', '0px');
                    core.style.setProperty('--dy', '0px');
                    core.style.animationDuration = '1s';
                    this.giftItems.appendChild(core);
                    setTimeout(() => core.remove(), 1400);
                }, (burstDelay + 0.55) * 1000);
            }
            // Cierra el modal al terminar la serie de fuegos artificiales
            const totalDuration = bursts * 0.18 + 3; // tiempo de disparo + animaciones
            setTimeout(() => this.closeModal(), totalDuration * 1000);
        }
    }

    (function() {
        const initModal = () => {
            try {
                new ChristmasModal();
            } catch (e) {
                console.error('Error al inicializar modal navide&ntilde;o:', e);
            }
        };
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initModal);
        else initModal();
    })();
</script>

</body>
</html>
